<?php /** @var \Airwallex\Payments\Model\Config\Adminhtml\UpdateSettings $block */ ?>
<script>
    require([
            'jquery'
        ],
        function(jQuery) {
            jQuery('#airwallex_update_settings').click(function() {
                new Ajax.Request('<?= $block->escapeJs($block->getUrl('airwallex/configuration/updateSettingsToken')) ?>', {
                    type: "GET",
                    asynchronous: true,
                    onSuccess: function(response) {
                        let domain = 'https://demo.airwallex.com/';
                        if (document.querySelector('[name="groups[airwallex_payments][groups][basic][fields][mode][value]"]').value === 'prod') {
                            domain = domain.replace('demo.airwallex', 'www.airwallex');
                        }
                        location.href = domain + "/index.html?" +
                            "domain=" + encodeURIComponent(location.href) +
                            "&token=" + response.responseJSON.token
                    },
                    onFailure: function(response) {},
                    onComplete: function() {}
                });
            });

        });
</script>

<?php echo $block->getButtonHtml() ?>